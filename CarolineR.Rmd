---
title: "Hackathon"
---


```{r}
library(tidyverse)

setwd("C:/Users/roosa/Documents/Diabetes-hackathon/data")
real_data <- read.csv("data/real_data.csv", stringsAsFactors =T)
data_set <- read.csv(file = 'data/synthetic_data.csv', na = 'No', stringsAsFactors = T)
head(data_set)
summary(data_set) 
medication_list <- c(colnames(data_set)[14:36])
#print(medication_list)
data_set <- data_set %>% separate(col = age, into = c("lower_age", "higher_age"), sep = "-")

data_set$lower_age <-as.numeric(sub(".", "", data_set$lower_age)) # split ages 
data_set$higher_age <- as.numeric(substr(data_set$higher_age, 1, nchar(data_set$higher_age)-1))
data_set$avg_age <- rowMeans(data_set[, c("lower_age", "higher_age")]) # create column with the avg age

data_set <- data_set %>% mutate(diabetesMed = ifelse(diabetesMed == "No", 0,1)) # modify diabetesMed to 0/1 instead of Yes/No

data_set_reformatted <- gather(data_set, medication, value, metformin:metformin.pioglitazone, na.rm = TRUE)
   #  na.rm = FALSE, convert = FALSE 

head(data_set_reformatted)  

data_set_reformatted$value_numeric <- as.numeric(as.factor(data_set_reformatted))
                                                            

```

```{r}
real_data <- read.csv("data/real_data.csv", stringsAsFactors =T)

real_data <- real_data %>% separate(col = age, into = c("lower_age", "higher_age"), sep = "-")

real_data$lower_age <-as.numeric(sub(".", "", real_data$lower_age)) # split ages 
real_data$higher_age <- as.numeric(substr(real_data$higher_age, 1, nchar(real_data$higher_age)-1))
real_data$avg_age <- rowMeans(real_data[, c("lower_age", "higher_age")]) # create column with the avg age

real_data <- real_data %>% mutate(diabetesMed = ifelse(diabetesMed == "No", 0,1)) # modify diabetesMed to 0/1 instead of Yes/No



```


```{r}
# count how many people take the different medications 
medications_dataframe <- data_set_reformatted %>%  
  group_by(medication) %>% summarise(n()) 

medications_dataframe 


#with(medications_dataframe, hist(medication))

#MedicationsHistogram <- ggplot(data=medications_dataframe, aes(x=medications_dataframe$medication, y=medications_dataframe$n())) + geom_bar()
#MedicationsHistogram

```


```{r}

early_readmission <- data_set_reformatted %>% filter(readmitted  == "<30")
readmitted_data <- data_set_reformatted %>% filter(readmitted == "<30" | readmitted == ">30")

# distributions of ages in different readmission times
ggplot(glucose_in_serum, aes(lower_age, fill = max_glu_serum)) + geom_bar(position = "dodge") +
  scale_x_continuous()

glucose_in_serum <- data_set_reformatted %>% filter(max_glu_serum == ">200" | max_glu_serum == ">300" | max_glu_serum == "Norm")



 
```

```{r}
# NOT READY, NOT NECESSARILY NEEDED EITHER
cluster_by_var <- function(dataset = data_set_reformatted, cluster_var, vec_of_features){
  data <- dataset %>% select(cluster_var, vec_of_features)
  data[is.na(data)] <- 0
  mat <- as.matrix(t(data))
  d <- dist(mat, method = "euclidean")
  hclust(d, method = "complete")
  
  
}
cluster_by_var(dataset = data_set, cluster_var = "avg_age", vec_of_features = medication_list)




```

```{r}
# FROM MARIDA BUT WITH REAL DATA

real_data %>% group_by(insulin) %>% ggplot() + geom_boxplot(aes(x = insulin,y = time_in_hospital))
insulins <- real_data %>% filter(insulin != "No")
ggplot(real_data) + geom_violin(aes(x = insulin, y = num_medications))
noinsulins <- real_data %>% filter(insulin == "No")


insulins %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram() + labs(title = "insulins, real data")

noinsulins %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram() + labs(title = "non-insulins, real data")


#_____________________________
ggplot(real_data, aes(readmitted, fill = insulin)) + geom_bar(position = "fill")  # readmitted with insulin information --> REAL DATA
ggplot(data_set, aes(readmitted, fill = insulin)) + geom_bar(position = "fill")  # readmitted with insulin information --> SYNTH DATA





```


